<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Healthcare Emissions Action Lab</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&amp;display=swap" rel="stylesheet">
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
    * { box-sizing: border-box; }
    html, body, #app { height: 100%; width: 100%; }
    body { font-family: 'Poppins', sans-serif; overflow: hidden; }
    
    .decision-card { transition: all 0.3s ease; }
    .decision-card:hover { transform: translateY(-4px); }
    .decision-card.selected { border-color: #10b981; background: linear-gradient(135deg, #ecfdf5, #d1fae5); }
    
    .carbon-bar { 
      background: linear-gradient(90deg, #ef4444 0%, #f97316 20%, #eab308 40%, #84cc16 60%, #22c55e 100%);
      height: 8px;
      border-radius: 4px;
      position: relative;
      overflow: hidden;
    }
    .carbon-progress {
      height: 100%;
      background: #1e293b;
      border-radius: 4px;
      transition: width 0.6s ease;
    }
    
    #app { display: flex; flex-direction: column; }
    #game-content { flex: 1; overflow-y: auto; }
  </style>
  <script src="https://cdn.tailwindcss.com/3.4.17" type="text/javascript"></script>
  <style>body { box-sizing: border-box; }</style>
 </head>
 <body class="bg-gradient-to-br from-emerald-900 via-slate-900 to-emerald-950 text-white">
  <div id="app">
   <!-- Welcome Screen -->
   <div id="welcome-screen" class="w-full h-full flex flex-col items-center justify-center p-6 bg-gradient-to-br from-emerald-900 via-slate-900 to-emerald-950">
    <div class="text-center max-w-2xl animate-in">
     <div class="text-8xl mb-6">
      üåç
     </div>
     <h1 class="text-5xl font-bold mb-3 bg-gradient-to-r from-emerald-300 to-teal-300 bg-clip-text text-transparent"><span id="welcome-title">Healthcare Emissions Action Lab</span></h1>
     <p class="text-2xl text-emerald-300/80 mb-2"><span id="welcome-subtitle">Alexandra Hospital</span></p>
     <p class="text-emerald-400/60 mb-8 text-lg">Net Zero by 2045</p>
     <div class="bg-slate-800/40 rounded-2xl p-8 mb-8 border border-emerald-700/30 space-y-4">
      <div class="flex items-center gap-4 text-left">
       <span class="text-4xl">üìä</span>
       <div>
        <p class="font-semibold text-emerald-300">7-Year Challenge</p>
        <p class="text-slate-400 text-sm">Make 3 strategic decisions each year</p>
       </div>
      </div>
      <div class="flex items-center gap-4 text-left">
       <span class="text-4xl">üéØ</span>
       <div>
        <p class="font-semibold text-emerald-300">40% Reduction Target</p>
        <p class="text-slate-400 text-sm">From 30,000 to ‚â§18,000 tonnes CO‚ÇÇe</p>
       </div>
      </div>
      <div class="flex items-center gap-4 text-left">
       <span class="text-4xl">‚ö°</span>
       <div>
        <p class="font-semibold text-emerald-300">Balance 6 Key Metrics</p>
        <p class="text-slate-400 text-sm">Navigate cost, emissions, energy, satisfaction, engagement, rating</p>
       </div>
      </div>
     </div><button onclick="startGame()" class="px-8 py-4 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 rounded-xl font-bold text-white shadow-lg shadow-emerald-500/25 transition-all text-lg"> Begin Challenge ‚Üí Year 1 </button>
    </div>
   </div><!-- Game Screen -->
   <div id="game-screen" class="hidden w-full h-full flex flex-col">
    <!-- Header -->
    <header class="bg-slate-900/80 backdrop-blur border-b border-emerald-700/30 p-6 flex-shrink-0">
     <div class="max-w-7xl mx-auto">
      <div class="flex items-center justify-between mb-4">
       <div>
        <h1 class="text-3xl font-bold bg-gradient-to-r from-emerald-400 to-teal-300 bg-clip-text text-transparent"><span id="game-title">Healthcare Emissions Action Lab</span></h1>
        <p class="text-emerald-300/70"><span id="year-label">Year 1</span> - Select 3 Initiatives</p>
       </div>
       <div class="text-right">
        <p class="text-sm text-slate-400">Progress</p>
        <p class="text-2xl font-bold text-emerald-400"><span id="progress">0</span>/7 Years</p>
       </div>
      </div><!-- Carbon Reduction Bar -->
      <div class="space-y-2">
       <div class="flex justify-between items-center text-sm">
        <span class="text-slate-400">Carbon Reduction Progress</span> <span class="font-semibold text-emerald-400"><span id="carbon-percent">0</span>% ‚Üí Goal: 40%</span>
       </div>
       <div class="carbon-bar">
        <div id="carbon-progress-bar" class="carbon-progress" style="width: 0%"></div>
       </div>
      </div>
     </div>
    </header><!-- Metrics Display -->
    <div class="bg-slate-900/40 p-4 flex-shrink-0">
     <div class="max-w-7xl mx-auto grid grid-cols-2 md:grid-cols-6 gap-2">
      <div class="bg-slate-800/60 rounded-lg p-3 border border-slate-700">
       <p class="text-xs text-slate-400">Operating Cost</p>
       <p id="metric-cost" class="text-base font-bold text-amber-400">$100M</p>
      </div>
      <div class="bg-slate-800/60 rounded-lg p-3 border border-slate-700">
       <p class="text-xs text-slate-400">Carbon</p>
       <p id="metric-carbon" class="text-base font-bold text-rose-400">30,000t</p>
      </div>
      <div class="bg-slate-800/60 rounded-lg p-3 border border-slate-700">
       <p class="text-xs text-slate-400">Electricity</p>
       <p id="metric-electricity" class="text-base font-bold text-sky-400">40M kWh</p>
      </div>
      <div class="bg-slate-800/60 rounded-lg p-3 border border-slate-700">
       <p class="text-xs text-slate-400">Patient Satisfaction</p>
       <p id="metric-patient" class="text-base font-bold text-purple-400">80</p>
      </div>
      <div class="bg-slate-800/60 rounded-lg p-3 border border-slate-700">
       <p class="text-xs text-slate-400">Employee Engagement</p>
       <p id="metric-employee" class="text-base font-bold text-blue-400">80</p>
      </div>
      <div class="bg-slate-800/60 rounded-lg p-3 border border-slate-700">
       <p class="text-xs text-slate-400">Hospital Rating</p>
       <p id="metric-rating" class="text-base font-bold text-yellow-400">3.0/5</p>
      </div>
     </div>
    </div><!-- Game Content -->
    <div id="game-content" class="flex-1 overflow-y-auto p-6">
     <div class="max-w-7xl mx-auto">
      <!-- Decision Phase -->
      <div id="decision-phase">
       <!-- Initiative Selection -->
       <div class="mb-8">
        <div class="flex items-center justify-between mb-6">
         <div>
          <h2 class="text-2xl font-bold text-emerald-400 mb-2">üéØ Select 3 Initiatives</h2>
          <p class="text-slate-400">Choose sustainability initiatives for your hospital</p>
         </div>
         <div class="text-right bg-gradient-to-r from-emerald-900/40 to-teal-900/40 rounded-lg p-4 border border-emerald-600/50">
          <p class="text-xs text-slate-400 mb-1">Initiatives Selected</p>
          <p class="text-3xl font-bold bg-gradient-to-r from-emerald-400 to-teal-300 bg-clip-text text-transparent"><span id="selection-count">0</span><span class="text-slate-400">/3</span></p>
         </div>
        </div><!-- Categories -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
         <div class="bg-slate-800/40 rounded-2xl p-6 border border-slate-700/50">
          <h3 class="text-emerald-400 font-bold mb-4 flex items-center gap-2">üèõÔ∏è Leadership &amp; Governance</h3>
          <div class="space-y-3" id="leadership-decisions"></div>
         </div>
         <div class="bg-slate-800/40 rounded-2xl p-6 border border-slate-700/50">
          <h3 class="text-sky-400 font-bold mb-4 flex items-center gap-2">üè• Clinical Practices</h3>
          <div class="space-y-3" id="clinical-decisions"></div>
         </div>
         <div class="bg-slate-800/40 rounded-2xl p-6 border border-slate-700/50">
          <h3 class="text-amber-400 font-bold mb-4 flex items-center gap-2">‚öôÔ∏è Operations</h3>
          <div class="space-y-3" id="operations-decisions"></div>
         </div>
         <div class="bg-slate-800/40 rounded-2xl p-6 border border-slate-700/50">
          <h3 class="text-rose-400 font-bold mb-4 flex items-center gap-2">üì¶ Supply Chain</h3>
          <div class="space-y-3" id="supply-decisions"></div>
         </div>
        </div>
       </div><!-- Training Budget -->
       <div class="bg-slate-800/40 rounded-2xl p-6 border border-slate-700/50 mb-8">
        <h2 class="text-2xl font-bold text-emerald-400 mb-6">üíº Staff Training Budget</h2>
        <p class="text-slate-400 mb-4">Invest in staff training for climate change awareness (2,000 employees)</p>
        <div class="space-y-4">
         <div>
          <div class="flex justify-between mb-2">
           <span class="text-slate-300">Budget: <span id="budget-display" class="font-bold text-emerald-400">$0</span></span> <span class="text-sm text-slate-400">Per employee: <span id="per-employee" class="font-bold">$0</span></span>
          </div><input type="range" id="training-slider" min="0" max="500000" step="25000" value="0" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer" oninput="updateTrainingBudget()">
         </div><!-- Quick Buttons -->
         <div class="grid grid-cols-5 gap-2">
          <button onclick="setTrainingBudget(0)" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-medium transition">$0</button> <button onclick="setTrainingBudget(125000)" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-medium transition">$125K</button> <button onclick="setTrainingBudget(250000)" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-medium transition">$250K</button> <button onclick="setTrainingBudget(375000)" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-medium transition">$375K</button> <button onclick="setTrainingBudget(500000)" class="px-3 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-medium transition">$500K</button>
         </div>
        </div>
       </div><!-- Confirm Button -->
       <div class="text-center mb-8">
        <button onclick="confirmYear()" class="px-8 py-4 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 rounded-xl font-bold text-white shadow-lg shadow-emerald-500/25 transition-all text-lg"> Complete Year &amp; See Results ‚Üí </button>
       </div>
      </div><!-- Results Phase -->
      <div id="results-phase" class="hidden pb-8">
       <!-- Year Summary -->
       <div class="mb-8">
        <h2 class="text-3xl font-bold text-emerald-400 mb-6">üìä Year <span id="result-year">1</span> Results</h2><!-- Training Feedback (Results Only) -->
        <div id="year-training-feedback" class="bg-blue-900/30 border border-blue-700/50 rounded-2xl p-6 mb-6 text-sm"></div><!-- Initiative Feedback (3 items) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6" id="initiative-feedback-container"></div><!-- Events -->
        <div id="events-container" class="mb-6"></div>
       </div><!-- Charts -->
       <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <div class="bg-slate-800/60 rounded-2xl p-6 border border-slate-700">
         <h4 class="text-amber-400 font-bold mb-4">Operating Costs ($M)</h4>
         <div style="position: relative; height: 200px;">
          <canvas id="chart-cost"></canvas>
         </div>
        </div>
        <div class="bg-slate-800/60 rounded-2xl p-6 border border-slate-700">
         <h4 class="text-rose-400 font-bold mb-4">Carbon Emissions (tonnes)</h4>
         <div style="position: relative; height: 200px;">
          <canvas id="chart-carbon"></canvas>
         </div>
        </div>
        <div class="bg-slate-800/60 rounded-2xl p-6 border border-slate-700">
         <h4 class="text-sky-400 font-bold mb-4">Electricity (M kWh)</h4>
         <div style="position: relative; height: 200px;">
          <canvas id="chart-electricity"></canvas>
         </div>
        </div>
       </div><!-- Other Metrics Charts -->
       <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <div class="bg-slate-800/60 rounded-2xl p-6 border border-slate-700">
         <h4 class="text-purple-400 font-bold mb-4">Patient Satisfaction</h4>
         <div style="position: relative; height: 200px;">
          <canvas id="chart-patient"></canvas>
         </div>
        </div>
        <div class="bg-slate-800/60 rounded-2xl p-6 border border-slate-700">
         <h4 class="text-blue-400 font-bold mb-4">Employee Engagement</h4>
         <div style="position: relative; height: 200px;">
          <canvas id="chart-employee"></canvas>
         </div>
        </div>
        <div class="bg-slate-800/60 rounded-2xl p-6 border border-slate-700">
         <h4 class="text-yellow-400 font-bold mb-4">Hospital Rating</h4>
         <div style="position: relative; height: 200px;">
          <canvas id="chart-rating"></canvas>
         </div>
        </div>
       </div><!-- Action Buttons -->
       <div class="text-center" id="action-buttons">
        <button onclick="nextYear()" class="px-8 py-4 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 rounded-xl font-bold text-white shadow-lg shadow-emerald-500/25 transition-all text-lg"> Continue to Year <span id="next-year-num">2</span> ‚Üí </button>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const TOTAL_YEARS = 7;
    const STARTING_METRICS = { cost: 100000000, carbon: 30000, electricity: 40000000, patient: 80, employee: 80, rating: 3 };
    const TARGET_CARBON = 18000;

    let gameState = {
      currentYear: 0,
      metrics: { ...STARTING_METRICS },
      historyMetrics: [{ ...STARTING_METRICS }],
      selectedInitiatives: [],
      trainingBudget: 0,
      allInitiatives: {},
      carryoverInitiatives: [],
      triggeredEvents: [],
      allSelectedOverGame: []
    };

    let charts = {};
    let currentConfig = { game_title: 'Healthcare Emissions Action Lab', welcome_title: 'Healthcare Emissions Action Lab', welcome_subtitle: 'Alexandra Hospital' };

    // === INITIATIVES DATABASE WITH DESCRIPTIONS ===
    const initiativesDatabase = {
      'year-1': [
        { id: 'y1-cso', name: 'Chief Sustainability Officer', icon: 'üëî', category: 'leadership', description: 'Hire a dedicated Chief Sustainability Officer to lead sustainability initiatives and coordinate hospital-wide efforts.', effects: { cost: 102000, carbon: -2500, electricity: -515000, patient: 0, employee: 2, rating: 0 }, feedback: 'The CSO quickly began having an impact through structured sustainability efforts, increased staff engagement, and greater effectiveness of training programs.' },
        { id: 'y1-board', name: 'Board Involvement', icon: 'üìã', category: 'leadership', description: 'Engage board members as sustainability champions to strengthen organizational commitment and accountability.', effects: { cost: 0, carbon: -1500, electricity: 0, patient: 0, employee: 1, rating: 1 }, feedback: 'Senior-level Board commitment is increasing staff engagement and strengthening the hospital\'s sustainability reputation.' },
        { id: 'y1-inhalers', name: 'Low Emission Inhalers', icon: 'üí®', category: 'clinical', description: 'Transition to low-emission inhaler technology that reduces propellant emissions by 50% with equivalent patient outcomes.', effects: { cost: 0, carbon: -160, electricity: 0, patient: 0, employee: 0, rating: 0 }, feedback: 'New low-emission inhalers reduce emissions by 50% with no negative impact on patient or staff care.' },
        { id: 'y1-prescription', name: 'Low Carbon Prescription Practices', icon: 'üíä', category: 'clinical', description: 'Implement evidence-based prescription protocols to reduce unnecessary medications and associated supply chain emissions.', effects: { cost: -1535000, carbon: -820, electricity: 0, patient: 0, employee: 0, rating: 0 }, feedback: 'New prescription practices reduce prescriptions and medication costs with no clinical quality impact.' },
        { id: 'y1-renewable', name: 'On-Site Renewable Energy', icon: '‚òÄÔ∏è', category: 'operations', description: 'Install solar panels and renewable generation systems to reduce grid electricity dependency and long-term energy costs.', effects: { cost: -10000, carbon: 0, electricity: -110000, patient: 0, employee: 0, rating: 0 }, feedback: 'Solar panels have been installed. Grid electricity consumption decreased. Embodied carbon impact will diminish in future years.' },
        { id: 'y1-led', name: 'LED Lighting', icon: 'üí°', category: 'operations', description: 'Replace all incandescent and fluorescent lighting with energy-efficient LEDs across the hospital campus.', effects: { cost: -500000, carbon: -900, electricity: -2300000, patient: 1, employee: 1, rating: 0 }, feedback: 'LED lights reduce electricity by 60%. Most feedback indicates staff preference for the new lighting.' },
        { id: 'y1-microgrid', name: 'Backup Microgrid', icon: 'üîã', category: 'operations', description: 'Develop a resilient microgrid with energy storage to ensure critical services during power disruptions.', effects: { cost: 25000, carbon: 25, electricity: 0, patient: 0, employee: 0, rating: 0 }, feedback: 'Backup microgrid provides resilience for power outages with minimal one-off embodied carbon impact.' },
        { id: 'y1-fleet', name: 'Low Carbon Fleet', icon: 'üöó', category: 'operations', description: 'Transition hospital transportation vehicles to electric and low-emission alternatives.', effects: { cost: -35000, carbon: -40, electricity: 65000, patient: 0, employee: 0, rating: 0 }, feedback: 'Low-emissions vehicles have high embodied carbon. Emissions benefits will be felt in future years.' },
        { id: 'y1-climate', name: 'Climate Control System', icon: '‚ùÑÔ∏è', category: 'operations', description: 'Upgrade HVAC systems with smart controls and high-efficiency equipment to reduce energy consumption by 15%.', effects: { cost: -660000, carbon: -1200, electricity: -3000000, patient: 2, employee: 2, rating: 0 }, feedback: 'Climate control reduces HVAC consumption by 15%. Temperature comfort has improved significantly.' },
        { id: 'y1-plastic', name: 'Single-Use Plastic Reduction', icon: '‚ôªÔ∏è', category: 'supply', description: 'Replace single-use plastics with reusable or compostable alternatives throughout the hospital.', effects: { cost: -47000, carbon: -170, electricity: 0, patient: 0, employee: 1, rating: 0 }, feedback: 'Limiting single-use plastics reduces costs and waste emissions. Few complaints from staff or patients.' },
        { id: 'y1-procurement', name: 'Low Carbon Procurement', icon: 'üåø', category: 'supply', description: 'Establish purchasing policies favoring suppliers with verified low-carbon operations and sustainable practices.', effects: { cost: 0, carbon: -3400, electricity: 0, patient: 0, employee: 1, rating: 1 }, feedback: 'Selecting sustainable suppliers reduces purchasing emissions by 20% without significantly impacting costs.' }
      ],
      'year-2': [
        { id: 'y2-financing', name: 'Green Financing Mechanism', icon: 'üíö', category: 'leadership', description: 'Create a dedicated green financing fund to accelerate sustainable infrastructure investments and improvements.', effects: { cost: 0, carbon: 0, electricity: 0, patient: 0, employee: 3, rating: 1 }, feedback: 'Green financing improves employee awareness and engagement, setting the stage for future projects.' },
        { id: 'y2-climate-plan', name: 'Planning for Disruptive Climate Events', icon: 'üåä', category: 'leadership', description: 'Develop comprehensive disaster preparedness plans addressing flooding, extreme heat, and supply chain disruptions.', effects: { cost: 100000, carbon: 0, electricity: 0, patient: 0, employee: 0, rating: 1 }, feedback: 'Climate preparedness measures complete. Hospital resilience against flooding and extreme weather increased.' },
        { id: 'y2-attire', name: 'Reusable Clinical Attire', icon: 'üëî', category: 'clinical', description: 'Switch from single-use clinical clothing to durable, reusable uniforms managed through hospital laundry services.', effects: { cost: 0, carbon: -230, electricity: 0, patient: 0, employee: 1, rating: 0 }, feedback: 'Emissions from waste and purchasing have gone down. Cost impact is neutral with longer-lasting items.' },
        { id: 'y2-anesthetic', name: 'Low Emission Anesthetic Practices', icon: 'üíâ', category: 'clinical', description: 'Reduce emissions from anesthetic gases by minimizing volatile anesthetic use and optimizing delivery methods.', effects: { cost: 0, carbon: -360, electricity: 0, patient: 0, employee: 0, rating: 0 }, feedback: 'Switching from desflurane and reducing flow rates achieves 30% emissions reduction per intervention safely.' },
        { id: 'y2-haze', name: 'Carbon Filters & Haze Fans', icon: 'üå´Ô∏è', category: 'operations', description: 'Install air filtration systems and outdoor air quality monitoring to protect patients and staff during haze events.', effects: { cost: 50000, carbon: 0, electricity: 0, patient: 2, employee: 1, rating: 1 }, feedback: 'Air quality improvements during haze episodes are significantly benefiting patient and staff health.' },
        { id: 'y2-cleanup', name: 'Annual Beach Clean-Up', icon: 'üèñÔ∏è', category: 'operations', description: 'Organize regular community environmental service days strengthening hospital reputation and team engagement.', effects: { cost: 0, carbon: -50, electricity: 0, patient: 0, employee: 4, rating: 2 }, feedback: 'Beach clean-up has strengthened the hospital\'s reputation as an environmental champion with excellent team morale.' },
        { id: 'y2-water', name: 'Efficient Use of Water', icon: 'üíß', category: 'operations', description: 'Install water-saving fixtures and optimize water heating systems to reduce consumption by 20%.', effects: { cost: -46500, carbon: -220, electricity: -100000, patient: 0, employee: 0, rating: 0 }, feedback: 'Water conservation measures cut consumption by 20% with reduced electricity from water heating.' },
        { id: 'y2-insulation', name: 'Improve Insulation', icon: 'üßä', category: 'operations', description: 'Upgrade building insulation and seal air leaks to improve thermal efficiency and reduce heating/cooling needs.', effects: { cost: -130000, carbon: -380, electricity: -1000000, patient: 1, employee: 0, rating: 0 }, feedback: 'Insulation improvements reduce HVAC energy by 1M kWh with notable cost savings.' },
        { id: 'y2-reprocessing', name: 'Medical Device Reprocessing', icon: 'üîß', category: 'supply', description: 'Implement sterile reprocessing programs for single-use medical devices where clinically safe to reduce waste.', effects: { cost: -47000, carbon: -1000, electricity: 0, patient: 0, employee: 0, rating: 1 }, feedback: 'Device reprocessing reduces medical waste emissions while saving $47K annually without care quality impact.' }
      ],
      'year-3': [
        { id: 'y3-commitment', name: 'Public Commitment', icon: 'üì¢', category: 'leadership', description: 'Make formal public commitments to Net Zero targets, improving transparency and accountability to stakeholders.', effects: { cost: -350000, carbon: -630, electricity: -1500000, patient: 1, employee: 2, rating: 2 }, feedback: 'Public commitment to emissions reduction has improved hospital ratings and increased Board and staff engagement.' },
        { id: 'y3-behavior', name: 'Behavior-Change Programme', icon: 'üéØ', category: 'leadership', description: 'Launch employee engagement campaigns to reduce energy use through behavioral changes (turning off lights, adjusting thermostats).', effects: { cost: -530000, carbon: -830, electricity: -2370000, patient: 2, employee: 3, rating: 1 }, feedback: 'TLC-inspired behavior changes reduce lighting and HVAC consumption significantly while improving patient sleep quality.' },
        { id: 'y3-inpatient', name: 'Reduce Avoidable Inpatient Days', icon: 'üõèÔ∏è', category: 'clinical', description: 'Improve discharge protocols and community partnerships to safely reduce unnecessary overnight hospital stays.', effects: { cost: 0, carbon: -210, electricity: 0, patient: 1, employee: 1, rating: 1 }, feedback: 'Reducing unnecessary overnight stays improves efficiency and reduces carbon intensity per patient admission.' },
        { id: 'y3-diagnostics', name: 'Reduce Unnecessary Diagnostic Tests', icon: 'üî¨', category: 'clinical', description: 'Update clinical protocols to eliminate redundant diagnostic tests while maintaining diagnostic accuracy and outcomes.', effects: { cost: -75000, carbon: -100, electricity: 0, patient: 0, employee: 1, rating: 0 }, feedback: 'Updated clinical protocols for essential tests save costs, reduce waste, with no clinical quality impact.' },
        { id: 'y3-lights', name: 'Install Light Sensors', icon: 'üîÜ', category: 'operations', description: 'Deploy motion sensors and occupancy-based lighting controls to automatically manage lighting in corridors and common areas.', effects: { cost: -50000, carbon: -100, electricity: -350000, patient: 0, employee: 1, rating: 0 }, feedback: 'Lighting sensors reduce energy in corridors by 60% with no negative staff or patient impact.' },
        { id: 'y3-biodigester', name: 'Biodigester Installation', icon: '‚ôªÔ∏è', category: 'operations', description: 'Install biodigestion systems to convert food waste into energy, reducing landfill volume and emissions.', effects: { cost: 0, carbon: -240, electricity: 0, patient: 0, employee: 0, rating: 0 }, feedback: 'Biodigester reduces food waste volume and emissions. Impact multiplied if combined with waste reduction.' },
        { id: 'y3-food', name: 'Low Emissions Food Programme', icon: 'ü•ó', category: 'supply', description: 'Shift hospital food sourcing to local, seasonal, and plant-based options with lower supply chain carbon footprint.', effects: { cost: -300000, carbon: -1150, electricity: 0, patient: 1, employee: 2, rating: 1 }, feedback: 'Locally sourced, seasonal, and plant-based options reduce food-related emissions by significant margin.' }
      ],
      'year-4': [
        { id: 'y4-travel', name: 'Green Travel Plan', icon: 'üö¥', category: 'leadership', description: 'Develop incentive programs for sustainable commuting including bike infrastructure, public transit subsidies, and carpooling.', effects: { cost: 9300, carbon: -650, electricity: 0, patient: 0, employee: 2, rating: 1 }, feedback: 'Improved bike lanes and transit incentives encourage sustainable commuting, reducing travel emissions by up to 20%.' },
        { id: 'y4-waste', name: 'Hazardous Waste Segregation', icon: '‚ö†Ô∏è', category: 'operations', description: 'Implement advanced waste segregation protocols to reduce hazardous waste volume and improve recycling rates.', effects: { cost: 23000, carbon: -180, electricity: 0, patient: 0, employee: 0, rating: 0 }, feedback: 'Better waste segregation reduces hazardous waste volume and disposal costs while increasing recycling.' },
        { id: 'y4-green-spaces', name: 'Optimize Green Spaces', icon: 'üå≥', category: 'operations', description: 'Expand hospital grounds with native vegetation and green roofs to improve air quality and staff wellbeing.', effects: { cost: 28000, carbon: 0, electricity: 0, patient: 3, employee: 3, rating: 1 }, feedback: 'Increased vegetation around hospital improves air quality and makes grounds more appealing.' },
        { id: 'y4-food-waste', name: 'Reduce Food Waste', icon: 'üçé', category: 'supply', description: 'Implement flexible meal portions and food donation programs to minimize food waste and loss.', effects: { cost: -140000, carbon: -100, electricity: 0, patient: 0, employee: 1, rating: 0 }, feedback: 'Flexible portions and donation programs reduce food waste emissions by 20% while saving 5% on food costs.' }
      ],
      'year-5': [
        { id: 'y5-rating', name: 'Get Sustainability Rating (ISO & JCI)', icon: 'üèÜ', category: 'leadership', description: 'Pursue ISO 14001 and JCI sustainability certifications to formalize and validate sustainability operations.', effects: { cost: 18600, carbon: 0, electricity: 0, patient: 1, employee: 2, rating: 2 }, feedback: 'Sustainability certification has promoted accountability and positioned hospital as environmental champion.' },
        { id: 'y5-ac', name: 'Air Conditioning System Upgrade', icon: '‚ùÑÔ∏è', category: 'operations', description: 'Replace outdated HVAC equipment with modern high-efficiency units using low-GWP refrigerants.', effects: { cost: -1260000, carbon: -2000, electricity: -500000, patient: 2, employee: 1, rating: 0 }, feedback: 'Modern energy-efficient AC units achieve 30% HVAC reduction with improved comfort.' },
        { id: 'y5-cleaning', name: 'Eco-Friendly Cleaning Materials', icon: 'üßπ', category: 'supply', description: 'Transition all cleaning products to biodegradable, eco-certified formulations safe for patients and environment.', effects: { cost: 52000, carbon: -50, electricity: 0, patient: 0, employee: 1, rating: 0 }, feedback: 'Eco-friendly products reduce water consumption and chemical pollution with minimal emissions impact.' }
      ],
      'year-6': [
        { id: 'y6-waste-reduction', name: 'Waste Reduction Programme', icon: 'üóëÔ∏è', category: 'supply', description: 'Establish bulk purchasing agreements and reduce packaging waste across all procurement categories.', effects: { cost: -2300, carbon: -238, electricity: 0, patient: 0, employee: 1, rating: 0 }, feedback: 'Bulk purchasing and reduced packaging lower waste emissions and generate cost savings.' }
      ],
      'year-7': [
        { id: 'y7-reusable', name: 'Reusable Product Initiative', icon: 'üîÅ', category: 'supply', description: 'Expand reusable product programs across clinical gowns, linens, and containers, reducing waste and purchasing.', effects: { cost: -46500, carbon: -410, electricity: 0, patient: 1, employee: 1, rating: 0 }, feedback: 'Reusable gowns, linens, and containers reduce purchasing and waste emissions by 10% safely.' }
      ]
    };

    const dataHandler = { onDataChanged(data) { console.log('Data updated:', data.length, 'records'); } };

    async function initGame() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (result.isOk) console.log('Data SDK ready');
      }
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig: { game_title: 'Healthcare Emissions Action Lab', welcome_title: 'Healthcare Emissions Action Lab', welcome_subtitle: 'Alexandra Hospital' },
          onConfigChange: (cfg) => { currentConfig = cfg; updateGameText(); },
          mapToCapabilities: () => ({ recolorables: [], borderables: [], fontEditable: undefined, fontSizeable: undefined }),
          mapToEditPanelValues: (cfg) => new Map([['hospital_name', cfg.welcome_subtitle || 'Alexandra Hospital'], ['game_title', cfg.game_title || 'Healthcare Emissions Action Lab'], ['game_subtitle', cfg.welcome_subtitle || 'Alexandra Hospital']])
        });
      }
    }

    function updateGameText() {
      if (document.getElementById('welcome-title')) document.getElementById('welcome-title').textContent = currentConfig.game_title || 'Healthcare Emissions Action Lab';
      if (document.getElementById('welcome-subtitle')) document.getElementById('welcome-subtitle').textContent = currentConfig.welcome_subtitle || 'Alexandra Hospital';
    }

    function startGame() {
      document.getElementById('welcome-screen').classList.add('hidden');
      document.getElementById('game-screen').classList.remove('hidden');
      gameState.currentYear = 1;
      loadYear(1);
    }

    function loadYear(year) {
      gameState.currentYear = year;
      gameState.selectedInitiatives = [];
      gameState.trainingBudget = 0;
      document.getElementById('decision-phase').classList.remove('hidden');
      document.getElementById('results-phase').classList.add('hidden');
      document.getElementById('selection-count').textContent = '0';
      document.getElementById('training-slider').value = 0;
      document.getElementById('year-label').textContent = `Year ${year}`;
      document.getElementById('progress').textContent = `${year}`;
      const carbonReduction = ((STARTING_METRICS.carbon - gameState.metrics.carbon) / STARTING_METRICS.carbon) * 100;
      document.getElementById('carbon-percent').textContent = Math.max(0, carbonReduction).toFixed(1);
      document.getElementById('carbon-progress-bar').style.width = Math.min(100, Math.max(0, carbonReduction)) + '%';
      populateInitiatives(year);
      updateMetricsDisplay();
      updateTrainingBudget();
    }

    function populateInitiatives(year) {
      const yearInitiatives = initiativesDatabase[`year-${year}`] || [];
      const allYearInitiatives = [...yearInitiatives, ...gameState.carryoverInitiatives];
      gameState.allInitiatives[`year-${year}`] = allYearInitiatives;
      const containers = {
        leadership: document.getElementById('leadership-decisions'),
        clinical: document.getElementById('clinical-decisions'),
        operations: document.getElementById('operations-decisions'),
        supply: document.getElementById('supply-decisions')
      };
      Object.values(containers).forEach(c => c.innerHTML = '');
      allYearInitiatives.forEach(initiative => {
        const card = document.createElement('div');
        card.className = 'decision-card bg-slate-700/50 rounded-lg p-3 border-2 border-transparent cursor-pointer hover:bg-slate-700';
        card.dataset.id = initiative.id;
        card.title = initiative.description || '';
        card.innerHTML = `
          <div class="flex items-start gap-3">
            <span class="text-lg flex-shrink-0">${initiative.icon}</span>
            <div class="min-w-0">
              <span class="font-medium text-slate-200 text-sm block">${initiative.name}</span>
              <span class="text-xs text-slate-400 line-clamp-2">${initiative.description || ''}</span>
            </div>
          </div>
        `;
        card.addEventListener('click', () => toggleInitiative(initiative.id, card));
        containers[initiative.category].appendChild(card);
      });
    }

    function toggleInitiative(id, card) {
      const index = gameState.selectedInitiatives.indexOf(id);
      if (index > -1) {
        gameState.selectedInitiatives.splice(index, 1);
        card.classList.remove('selected');
      } else {
        if (gameState.selectedInitiatives.length >= 3) {
          showNotification('Maximum 3 per year');
          return;
        }
        gameState.selectedInitiatives.push(id);
        card.classList.add('selected');
      }
      document.getElementById('selection-count').textContent = gameState.selectedInitiatives.length;
    }

    function updateTrainingBudget() {
      const budget = parseInt(document.getElementById('training-slider').value);
      gameState.trainingBudget = budget;
      document.getElementById('budget-display').textContent = `$${(budget / 1000).toFixed(0)}K`;
      document.getElementById('per-employee').textContent = `$${(budget / 2000).toFixed(0)}`;
    }

    function setTrainingBudget(amount) {
      document.getElementById('training-slider').value = amount;
      updateTrainingBudget();
    }

    async function confirmYear() {
      if (gameState.selectedInitiatives.length === 0) {
        showNotification('Select at least 1');
        return;
      }
      let feedbacks = [];
      gameState.selectedInitiatives.forEach(id => {
        const initiative = gameState.allInitiatives[`year-${gameState.currentYear}`].find(i => i.id === id);
        if (initiative) {
          gameState.metrics.cost += initiative.effects.cost;
          gameState.metrics.carbon += initiative.effects.carbon;
          gameState.metrics.electricity += initiative.effects.electricity;
          gameState.metrics.patient += initiative.effects.patient;
          gameState.metrics.employee += initiative.effects.employee;
          gameState.metrics.rating += initiative.effects.rating;
          feedbacks.push({ name: initiative.name, feedback: initiative.feedback });
          gameState.allSelectedOverGame.push(id);
        }
      });
      gameState.metrics.carbon = Math.max(0, gameState.metrics.carbon);
      gameState.metrics.patient = Math.max(0, Math.min(100, gameState.metrics.patient));
      gameState.metrics.employee = Math.max(0, Math.min(100, gameState.metrics.employee));
      gameState.metrics.rating = Math.max(0, Math.min(5, gameState.metrics.rating));
      if (gameState.trainingBudget > 0) {
        gameState.metrics.employee += 2;
        gameState.metrics.employee = Math.min(100, gameState.metrics.employee);
      }
      checkEvents(gameState.currentYear);
      gameState.historyMetrics.push({ ...gameState.metrics });
      if (window.dataSdk) {
        await window.dataSdk.create({
          year: gameState.currentYear,
          selected_initiatives: gameState.selectedInitiatives.join(','),
          training_budget: gameState.trainingBudget,
          carbon_tonnes: gameState.metrics.carbon,
          operating_cost: gameState.metrics.cost,
          electricity_kwh: gameState.metrics.electricity,
          patient_satisfaction: gameState.metrics.patient,
          employee_engagement: gameState.metrics.employee,
          hospital_rating: gameState.metrics.rating,
          events_triggered: gameState.triggeredEvents.join(',')
        });
      }
      showResults(feedbacks);
    }

    function checkEvents(year) {
      gameState.triggeredEvents = [];
      if (year === 3 && gameState.metrics.electricity > 35000000) {
        gameState.metrics.cost += 465000;
        gameState.triggeredEvents.push('energy-crisis');
      }
      if (year === 4 && !gameState.allSelectedOverGame.includes('y2-climate-plan')) {
        gameState.metrics.cost += 2000000;
        gameState.metrics.patient -= 20;
        gameState.metrics.employee -= 20;
        gameState.triggeredEvents.push('flood');
      }
      if (year === 6) {
        if (!gameState.allSelectedOverGame.includes('y2-haze')) {
          gameState.metrics.rating -= 1;
          gameState.metrics.employee -= 20;
          gameState.metrics.patient -= 20;
          gameState.triggeredEvents.push('haze');
        }
      }
      gameState.metrics.patient = Math.max(0, Math.min(100, gameState.metrics.patient));
      gameState.metrics.employee = Math.max(0, Math.min(100, gameState.metrics.employee));
      gameState.metrics.rating = Math.max(0, gameState.metrics.rating);
    }

    function showResults(feedbacks) {
      document.getElementById('decision-phase').classList.add('hidden');
      document.getElementById('results-phase').classList.remove('hidden');
      document.getElementById('result-year').textContent = gameState.currentYear;
      
      // Training feedback (ONLY on results page)
      const trainingFeedbackDiv = document.getElementById('year-training-feedback');
      let trainingMsg = '';
      if (gameState.trainingBudget === 0) {
        trainingMsg = '‚ö†Ô∏è <strong>No Staff Training:</strong> Without training, your employees lack knowledge to drive sustainability forward.';
      } else if (gameState.trainingBudget <= 250000) {
        trainingMsg = '‚úì <strong>Staff Training Invested:</strong> Your team has gained skills and motivation to support initiatives.';
      } else {
        trainingMsg = '‚ö° <strong>Significant Training Investment:</strong> Comprehensive development is supporting organization-wide behavior change.';
      }
      trainingFeedbackDiv.innerHTML = trainingMsg;

      // Initiative feedback (3 selected items, feedback only)
      const feedbackContainer = document.getElementById('initiative-feedback-container');
      feedbackContainer.innerHTML = '';
      feedbacks.forEach(item => {
        const fb = document.createElement('div');
        fb.className = 'bg-slate-800/60 rounded-lg p-4 border border-emerald-700/30';
        fb.innerHTML = `
          <p class="font-semibold text-emerald-400 mb-2">${item.name}</p>
          <p class="text-slate-300 text-sm">${item.feedback}</p>
        `;
        feedbackContainer.appendChild(fb);
      });

      // Events with updated feedback
      const eventsContainer = document.getElementById('events-container');
      eventsContainer.innerHTML = '';
      if (gameState.triggeredEvents.length > 0) {
        gameState.triggeredEvents.forEach(event => {
          const div = document.createElement('div');
          const eventData = {
            'energy-crisis': {
              icon: '‚ö°',
              title: 'Energy Crisis!',
              message: 'The energy crisis is putting significant pressure on our hospital\'s profitability. Energy consumption remains above 35M kWh, and the introduction of Singapore\'s carbon tax has driven energy prices sharply upward, increasing annual operating costs by $465K and accelerating resource depletion.'
            },
            'flood': {
              icon: 'üåä',
              title: 'Severe Flood!',
              message: 'A severe flood engulfs your hospital. Without preparation, backup generators fail. Essential services shut down, forcing emergency diversions and equipment damage.'
            },
            'haze': {
              icon: 'üå´Ô∏è',
              title: 'Haze Crisis!',
              message: 'Patients and staff express concerns over air quality during haze episodes. Complaints rising. Hospital experience negatively affected.'
            }
          };
          const eventInfo = eventData[event];
          if (eventInfo) {
            div.className = 'bg-rose-900/30 border border-rose-700/50 rounded-lg p-4 mb-4';
            div.innerHTML = `<strong>${eventInfo.icon} ${eventInfo.title}</strong> ${eventInfo.message}`;
            eventsContainer.appendChild(div);
          }
        });
      }
      updateMetricsDisplay();
      setTimeout(() => createResultCharts(), 100);
      if (gameState.currentYear < TOTAL_YEARS) {
        document.getElementById('action-buttons').innerHTML = `<button onclick="nextYear()" class="px-8 py-4 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 rounded-xl font-bold text-white shadow-lg shadow-emerald-500/25 transition-all text-lg">Continue to Year ${gameState.currentYear + 1} ‚Üí</button>`;
      } else {
        showGameEnd();
      }
    }

    function nextYear() {
      const yearInitiatives = gameState.allInitiatives[`year-${gameState.currentYear}`];
      gameState.carryoverInitiatives = yearInitiatives.filter(init => !gameState.selectedInitiatives.includes(init.id));
      loadYear(gameState.currentYear + 1);
    }

    function updateMetricsDisplay() {
      document.getElementById('metric-cost').textContent = `$${(gameState.metrics.cost / 1000000).toFixed(1)}M`;
      document.getElementById('metric-carbon').textContent = `${gameState.metrics.carbon.toLocaleString()}t`;
      document.getElementById('metric-electricity').textContent = `${(gameState.metrics.electricity / 1000000).toFixed(0)}M kWh`;
      document.getElementById('metric-patient').textContent = `${gameState.metrics.patient}`;
      document.getElementById('metric-employee').textContent = `${gameState.metrics.employee}`;
      document.getElementById('metric-rating').textContent = `${gameState.metrics.rating.toFixed(1)}/5`;
      const carbonReduction = ((STARTING_METRICS.carbon - gameState.metrics.carbon) / STARTING_METRICS.carbon) * 100;
      document.getElementById('carbon-percent').textContent = Math.max(0, carbonReduction).toFixed(1);
      document.getElementById('carbon-progress-bar').style.width = Math.min(100, Math.max(0, carbonReduction)) + '%';
    }

    function createResultCharts() {
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: 'rgba(255,255,255,0.5)', font: { size: 10 } } },
          y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: 'rgba(255,255,255,0.5)', font: { size: 10 } } }
        }
      };
      const years = Array.from({ length: gameState.historyMetrics.length }, (_, i) => i === 0 ? 'Start' : `Y${i}`);
      const costData = gameState.historyMetrics.map(m => m.cost / 1000000);
      const carbonData = gameState.historyMetrics.map(m => m.carbon);
      const elecData = gameState.historyMetrics.map(m => m.electricity / 1000000);
      const patientData = gameState.historyMetrics.map(m => m.patient);
      const empData = gameState.historyMetrics.map(m => m.employee);
      const ratingData = gameState.historyMetrics.map(m => m.rating);
      Object.values(charts).forEach(c => c && c.destroy && c.destroy());
      charts = {};
      const costCtx = document.getElementById('chart-cost');
      charts.cost = new Chart(costCtx, {
        type: 'line', data: { labels: years, datasets: [{ data: costData, borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.1)', fill: true, tension: 0.4, pointRadius: 3 }] },
        options: chartOptions
      });
      const carbonCtx = document.getElementById('chart-carbon');
      charts.carbon = new Chart(carbonCtx, {
        type: 'line', data: { labels: years, datasets: [{ data: carbonData, borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: true, tension: 0.4, pointRadius: 3 }] },
        options: chartOptions
      });
      const elecCtx = document.getElementById('chart-electricity');
      charts.electricity = new Chart(elecCtx, {
        type: 'line', data: { labels: years, datasets: [{ data: elecData, borderColor: '#0ea5e9', backgroundColor: 'rgba(14, 165, 233, 0.1)', fill: true, tension: 0.4, pointRadius: 3 }] },
        options: chartOptions
      });
      const patientCtx = document.getElementById('chart-patient');
      charts.patient = new Chart(patientCtx, {
        type: 'line', data: { labels: years, datasets: [{ data: patientData, borderColor: '#a855f7', backgroundColor: 'rgba(168, 85, 247, 0.1)', fill: true, tension: 0.4, pointRadius: 3 }] },
        options: chartOptions
      });
      const empCtx = document.getElementById('chart-employee');
      charts.employee = new Chart(empCtx, {
        type: 'line', data: { labels: years, datasets: [{ data: empData, borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', fill: true, tension: 0.4, pointRadius: 3 }] },
        options: chartOptions
      });
      const ratingCtx = document.getElementById('chart-rating');
      charts.rating = new Chart(ratingCtx, {
        type: 'line', data: { labels: years, datasets: [{ data: ratingData, borderColor: '#fbbf24', backgroundColor: 'rgba(251, 191, 36, 0.1)', fill: true, tension: 0.4, pointRadius: 3 }] },
        options: chartOptions
      });
    }

    function showGameEnd() {
      const carbonReduction = ((STARTING_METRICS.carbon - gameState.metrics.carbon) / STARTING_METRICS.carbon) * 100;
      const success = gameState.metrics.carbon <= TARGET_CARBON;
      let content = `
        <div class="text-center space-y-6">
          <div class="text-7xl">${success ? 'üéâ' : 'üå±'}</div>
          <h2 class="text-4xl font-bold ${success ? 'text-emerald-400' : 'text-amber-400'}">${success ? 'Mission Accomplished!' : 'Great Effort!'}</h2>
          <div class="bg-slate-800/40 rounded-2xl p-8 space-y-4 border border-slate-700">
            <div class="text-2xl font-bold">Final Results</div>
            <div class="grid grid-cols-2 gap-4 text-left">
              <div><span class="text-slate-400">Carbon Emissions:</span> <span class="font-bold text-lg ${success ? 'text-emerald-400' : 'text-rose-400'}">${gameState.metrics.carbon.toLocaleString()}t</span></div>
              <div><span class="text-slate-400">Target:</span> <span class="font-bold text-lg">‚â§${TARGET_CARBON.toLocaleString()}t</span></div>
              <div><span class="text-slate-400">Reduction:</span> <span class="font-bold text-lg text-emerald-400">${carbonReduction.toFixed(1)}%</span></div>
              <div><span class="text-slate-400">Hospital Rating:</span> <span class="font-bold text-lg">${gameState.metrics.rating.toFixed(1)}/5</span></div>
            </div>
          </div>
          ${success ? `<p class="text-emerald-300 text-lg">Your strategic decisions achieved a ${carbonReduction.toFixed(1)}% reduction, contributing significantly to Net Zero 2045!</p>` : `<p class="text-amber-300 text-lg">You achieved a ${carbonReduction.toFixed(1)}% reduction. Try again to reach 40% and Net Zero status!</p>`}
          <button onclick="location.reload()" class="px-8 py-4 bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-400 hover:to-teal-400 rounded-xl font-bold text-white shadow-lg">Play Again</button>
        </div>
      `;
      document.getElementById('action-buttons').innerHTML = content;
    }

    function showNotification(msg) {
      const count = document.getElementById('selection-count');
      const original = count.textContent;
      count.textContent = msg;
      count.classList.add('text-amber-400');
      setTimeout(() => {
        count.textContent = original;
        count.classList.remove('text-amber-400');
      }, 1500);
    }

    window.addEventListener('DOMContentLoaded', initGame);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d233d9d70b96cc1',t:'MTc3MTgxMzE5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>